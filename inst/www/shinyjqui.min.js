shinyjqui=function(){var shinyMode=void 0!==window.Shiny&&!!window.Shiny.outputBindings,getInputContainer=function(e){if(!$(e).hasClass("shiny-bound-input"))return e;if($(e).hasClass("btn"))return e;var t=$(e).closest(".shiny-input-container");return t.length?t.get(0):e},regShinyInput=function(e,t,n){$.each(n,function(n,i){var a=t+"_"+n;$.each(i,function(t,n){$(e).on(t,function(e,t){if("resize"!=e.type||void 0!==t){var i=n(e,t);Shiny.onInputChange(a,i)}})})})},handleShinyInput=function(e,t,n){if(!shinyMode)return null;var i=shinyjqui.getId(e);if(i){var a=Object.assign({},n);if(t&&t.hasOwnProperty("shiny")){var r=Object.keys(a);$.each(r,function(e,n){$.inArray(n.replace(/:.+/,""),Object.keys(t.shiny))>=0&&delete a[n]}),$.extend(a,t.shiny),delete t.shiny}regShinyInput(e,i,a)}},evaluateJSExpressions=function(opt,idx){$.each(idx,function(key,value){!0===value&&opt[key]?opt[key]=eval("("+opt[key]+")"):"object"==typeof value&&evaluateJSExpressions(opt[key],value)})},evalJS=function(e){var t=e._js_idx;return t&&"object"==typeof t&&evaluateJSExpressions(e,t),e},handleServerMsg=function(e){e=evalJS(e);var t=$(e.ui);if(t)return t=t.map(function(e,t){return t=getInputContainer(t),t=addWrapper(t),t=getWrapper(t)}),e.debug&&(console.log("==================="),console.log("ELEMENTS: "),console.log(t),console.log("MSG: "),console.log(e),console.log("===================")),{elements:t,type:e.type,func:e.func,operation:e.operation,options:e.options};console.warn("The selector didn't match any element. Operation abort.")},isHidden=function(e){return null!==e&&0===e.offsetWidth&&0===e.offsetHeight&&("none"===getStyle(e,"display")||isHidden(e.parentNode))},addJquiData=function(e){$(e).data("shinyjqui")||$(e).data("shinyjqui",{draggable:{save:{}},droppable:{save:{}},resizable:{save:{}},selectable:{save:{}},sortable:{save:{}}})},removeJquiData=function(e){var t=$(e);t.hasClass("jqui-wrapper")&&(t.hasClass("ui-draggable")||t.hasClass("ui-droppable")||t.hasClass("ui-selectable")||t.hasClass("ui-sortable")||t.hasClass("ui-resizable")||t.removeData("shinyjqui"))},addWrapper=function(e){if($(e).parent().hasClass("jqui-wrapper"))return e;if("htmlwidget_container"==$(e).parent().attr("id"))return $(e).parent().get(0);if(!/action-button|html-widget-output|shiny-.+?-output|html-widget-static-bound/.test($(e).attr("class")))return e;var t=$("<div></div>").outerWidth($(e).outerWidth()?$(e).outerWidth():"100%").outerHeight($(e).outerHeight()?$(e).outerHeight():"100%").css($(e).css(["top","left"])).addClass("jqui-wrapper");return $(e).wrap(t).outerWidth("100%").outerHeight("100%").css({top:"0px",left:"0px"}).parent().get(0)},removeWrapper=function(e){var t=$(e);t.hasClass("jqui-wrapper")&&(t.hasClass("ui-draggable")||t.hasClass("ui-droppable")||t.hasClass("ui-selectable")||t.hasClass("ui-sortable")||t.hasClass("ui-resizable")||(t.children(".shiny-bound-output").outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).css(t.css(["top","left"])).insertAfter(t),t.remove()))},getWrapper=function(e){return $(e).parent().hasClass("jqui-wrapper")&&(e=$(e).parent().get(0)),e},addIndex=function(e){var t=$(e),n=shinyjqui.getId(e);if(t.hasClass("ui-sortable")&&n&&(t.find(".ui-sortable-handle").attr("jqui_sortable_idx",function(e,t){return n+"__"+(e+1)}),t.trigger("sortcreate")),t.hasClass("ui-draggable")&&t.draggable("option","connectToSortable")&&!t.is("[jqui_sortable_idx]")){var i=$(".ui-draggable").filter("[jqui_sortable_idx]").length;t.attr("jqui_sortable_idx",i+1)}t.hasClass("ui-selectable")&&n&&(t.find(".ui-selectee").attr("jqui_selectable_idx",function(e,t){return n+"__"+(e+1)}),t.trigger("selectablecreate"))},removeIndex=function(e){var t=$(e);t.hasClass("ui-selectable")||t.find(".ui-selectee").removeAttr("jqui_seletable_idx"),t.hasClass("ui-sortable")||t.find(".ui-sortable-handle").removeAttr("jqui_sortable_idx"),t.hasClass("ui-draggable")||t.removeAttr("jqui_sortable_idx")},interaction_settings={draggable:{getState:function(e){return $(e).offset()},setState:function(e,t){var n=$(e),i=new $.Event("mousedown",{pageX:n.offset().left,pageY:n.offset().top}),a=new $.Event("mouseup",{pageX:t.left,pageY:t.top});n.data("uiDraggable")._mouseStart(i),n.data("uiDraggable")._mouseDrag(a),n.data("uiDraggable")._mouseStop(a)},shiny:{_shinyjquiBookmarkState__draggable:{"dragcreate dragstop":function(e,t){return interaction_settings.draggable.getState(e.target)}},position:{"dragcreate drag dragstop":function(e,t){return $(e.target).position()}},is_dragging:{"dragcreate dragstop":function(e,t){return!1},dragstart:function(e,t){return!0}}}},droppable:{getState:function(e){},setState:function(e,t){},shiny:{over:{dropcreate:function(e,t){return[]},dropover:function(e,t){return shinyjqui.getId(t.draggable.get(0))}},drop:{dropcreate:function(e,t){return[]},drop:function(e,t){return shinyjqui.getId(t.draggable.get(0))}},out:{dropcreate:function(e,t){return[]},dropout:function(e,t){return shinyjqui.getId(t.draggable.get(0))}},dragging:{dropcreate:function(e,t){return[]},dropactivate:function(e,t){return shinyjqui.getId(t.draggable.get(0))},dropdeactivate:function(e,t){return[]}},dropped:{dropcreate:function(e,t){return $(e.target).data("shinyjqui_droppedIds",[]),[]},drop:function(e,t){var n=$(e.target).data("shinyjqui_droppedIds"),i=shinyjqui.getId(t.draggable.get(0));return-1==$.inArray(i,n)&&n.push(i),$(e.target).data("shinyjqui_droppedIds",n),n},dropout:function(e,t){var n=$(e.target).data("shinyjqui_droppedIds"),i=shinyjqui.getId(t.draggable.get(0));return n.splice($.inArray(i,n),1),$(e.target).data("shinyjqui_droppedIds",n),n}}}},resizable:{getState:function(e){return{width:$(e).width(),height:$(e).height()}},setState:function(e,t){var n=$(e),i=new $.Event("mousedown",{pageX:0,pageY:0}),a=new $.Event("mouseup",{pageX:t.width-n.width(),pageY:t.height-n.height()});n.data("uiResizable").axis="se",n.data("uiResizable")._mouseStart(i),n.data("uiResizable")._mouseDrag(a),n.data("uiResizable")._mouseStop(a)},shiny:{_shinyjquiBookmarkState__resizable:{"resizecreate resizestop":function(e,t){return interaction_settings.resizable.getState(e.target)}},size:{"resize resizestop":function(e,t){return{width:t.size.width,height:t.size.height}},resizecreate:function(e,t){return{width:$(e.target).width(),height:$(e.target).height()}}},is_resizing:{"resizecreate resizestop":function(e,t){return!1},resizestart:function(e,t){return!0}}}},selectable:{getState:function(e){var t=$(e).find(".ui-selected"),n=t.map(function(e,t){return $(t).attr("jqui_selectable_idx")}).get();return{selected:t,index:n}},setState:function(e,t){var n,i=$(e),a=i.selectable("option","classes.ui-selected");a=a?"ui-selected "+a:"ui-selected",t.selected instanceof jQuery?n=t.selected:(Array.isArray(t.index)||(t.index=Array(t.index)),n=$(t.index).map(function(e,t){return $("[jqui_selectable_idx="+t+"]").get(0)})),i.find(".ui-selected").not(n).removeClass(a).addClass("ui-unselecting"),n.not(".ui-selected").addClass("ui-selecting"),i.data("uiSelectable")._mouseStop(null)},shiny:{_shinyjquiBookmarkState__selectable:{"selectablecreate selectablestop":function(e,t){var n=interaction_settings.selectable.getState(e.target);return n.selected="",n}},"selected:shinyjqui.df":{"selectablecreate selectablestop":function(e,t){var n=$(e.target).find(".ui-selected"),i=n.map(function(e,t){return t.innerText?t.innerText:""}).get();return{id:n.map(function(e,t){return shinyjqui.getId(t)}).get(),text:i}}},is_selecting:{"selectablecreate selectablestop":function(e,t){return!1},selectablestart:function(e,t){return!0}}}},sortable:{getState:function(e){var t=$(e).find(".ui-sortable-handle,.ui-draggable").clone(),n=t.map(function(e,t){return $(t).attr("jqui_sortable_idx")}).get();return{items:t,index:n}},setState:function(e,t){var n=$(e),i=n.find(".ui-sortable-handle,.ui-draggable"),a=i.length?i.parent():n;if(t.items instanceof jQuery)i.remove(),a.append(t.items);else{Array.isArray(t.index)||(t.index=Array(t.index));var r,s=i.clone(),o=$("body").data("shinyjquiTemp");o?$("body").data("shinyjquiTemp",o.add(s)):$("body").data("shinyjquiTemp",s),i.remove(),$.each(t.index,function(e,t){var n=$("body").data("shinyjquiTemp").filter("[jqui_sortable_idx="+t+"]").first();return 1==n.length?(a.append(n),!0):0==(n=$("[jqui_sortable_idx="+t+"]").first()).length?(console.warn("Can't find item [jqui_sortable_idx="+t+"] durining bookmarking restoration!"),!0):void(n.hasClass("ui-draggable")?n.clone().appendTo(a):(r=n.closest(".ui-sortable"),n.appendTo(a),r.trigger("sortupdate")))})}n.trigger("sortupdate")},shiny:{_shinyjquiBookmarkState__sortable:{"sortcreate sortupdate":function(e,t){var n=interaction_settings.sortable.getState(e.target);return n.items="",n}},"order:shinyjqui.df":{"sortcreate sortupdate":function(e,t){var n=$(e.target).find("[jqui_sortable_idx]"),i=n.map(function(e,t){return t.innerText?t.innerText:""}).get();return{id:n.map(function(e,t){return shinyjqui.getId(t)}).get(),text:i}}}}}},interaction={enable:function(e,t,n){handleShinyInput(e,n,interaction_settings[t].shiny),$(e)[t](n),$(e)[t]("enable"),addJquiData(e),addIndex(e)},disable:function(e,t,n){handleShinyInput(e,n,interaction_settings[t].shiny),$(e)[t](n),$(e)[t]("disable")},destroy:function(e,t,n){var i=$(e);i.hasClass("ui-"+t)?(i[t]("destroy"),removeJquiData(e),removeWrapper(e),removeIndex(e)):console.warn("Interaction not initiated. Operation abort.")},save:function(e,t,n){var i=$(e);handleShinyInput(e,n,interaction_settings[t].shiny),i[t](n),i.data("shinyjqui")[t].save={option:i[t]("option"),state:interaction_settings[t].getState(e)}},load:function(e,t,n){var i=$(e);i.hasClass("ui-"+t)||(console.warn("Interaction not initiated. Will run initiation first."),i[t]());var a=n||i.data("shinyjqui")[t].save;a?(a.option&&i[t]("option",a.option),a.state&&interaction_settings[t].setState(e,a.state)):console.warn("Nothing can be load. Operation abort.")}};return{getId:function(e){var t=$(e).attr("id");return!t&&$(e).hasClass("tabbable")&&(t=$(e).find(".shiny-bound-input").attr("id")),t||(t=$(e).closest(".shiny-input-container").find(".shiny-bound-input").attr("id")),t||(t=$(e).closest(".shiny-bound-output").attr("id")),t||(t=$(e).closest(".jqui-wrapper").find(".shiny-bound-output").attr("id")),t||""},msgCallback:function(e){if(e=handleServerMsg(e)){var t=e.elements,n=e.type,i=e.operation,a=e.func,r=e.options;"interaction"===n?t.each(function(e,t){interaction[i](t,a,r)}):"effect"===n?t[a](effect=r.effect,options=r.options,duration=r.duration,complete=r.complete):"class"===n?"add"===a||"remove"===a?t[a+"Class"](r.className,r):"switch"===a&&t.switchClass(r.removeClassName,r.addClassName,r):"other"===n&&"position"===a&&t.position(r)}},init:function(){shinyMode&&Shiny.addCustomMessageHandler("shinyjqui",shinyjqui.msgCallback)}}}(),shinyjqui.init();
