shinyjqui=function(){var shinyMode=void 0!==window.Shiny&&!!window.Shiny.outputBindings,getInputContainer=function(e){if(!$(e).hasClass("shiny-bound-input"))return e;if($(e).hasClass("btn"))return e;var t=$(e).closest(".shiny-input-container");return t.length?t.get(0):e},regShinyInput=function(e,t,i){$.each(i,function(i,n){var a=t+"_"+i;$.each(n,function(t,i){$(e).on(t,function(e,t){if($(e.target).hasClass("shinyjqui")&&("resize"!=e.type||void 0!==t)){var n=i(e,t);Shiny.onInputChange(a,n)}})})})},handleShinyInput=function(e,t,i){if(!shinyMode)return null;var n=shinyjqui.getId(e);if(n){var a=Object.assign({},i);if(t&&t.hasOwnProperty("shiny")){var r=Object.keys(a);$.each(r,function(e,i){$.inArray(i.replace(/:.+/,""),Object.keys(t.shiny))>=0&&delete a[i]}),$.extend(a,t.shiny),delete t.shiny}regShinyInput(e,n,a)}},evaluateJSExpressions=function(opt,idx){$.each(idx,function(key,value){!0===value&&opt[key]?opt[key]=eval("("+opt[key]+")"):"object"==typeof value&&evaluateJSExpressions(opt[key],value)})},evalJS=function(e){var t=e._js_idx;return t&&"object"==typeof t&&evaluateJSExpressions(e,t),e},handleServerMsg=function(e){e=evalJS(e);var t=$(e.ui);if(t)return t=t.map(function(e,t){return t=getInputContainer(t),t=addWrapper(t),(t=getWrapper(t)).classList.add("shinyjqui"),t}),e.debug&&(console.log("==================="),console.log("ELEMENTS: "),console.log(t),console.log("MSG: "),console.log(e),console.log("===================")),{elements:t,type:e.type,func:e.func,operation:e.operation,options:e.options};console.warn("The selector didn't match any element. Operation abort.")},isHidden=function(e){return null!==e&&0===e.offsetWidth&&0===e.offsetHeight&&("none"===getStyle(e,"display")||isHidden(e.parentNode))},addJquiData=function(e){$(e).data("shinyjqui")||$(e).data("shinyjqui",{draggable:{save:{}},droppable:{save:{}},resizable:{save:{}},selectable:{save:{}},sortable:{save:{}}})},removeJquiData=function(e){var t=$(e);t.hasClass("jqui-wrapper")&&(t.hasClass("ui-draggable")||t.hasClass("ui-droppable")||t.hasClass("ui-selectable")||t.hasClass("ui-sortable")||t.hasClass("ui-resizable")||t.removeData("shinyjqui"))},addWrapper=function(e){if($(e).parent().hasClass("jqui-wrapper"))return e;if("htmlwidget_container"==$(e).parent().attr("id"))return $(e).parent().get(0);if(!/action-button|html-widget-output|shiny-.+?-output|html-widget-static-bound/.test($(e).attr("class")))return e;var t=$("<div></div>").outerWidth($(e).outerWidth()?$(e).outerWidth():"100%").outerHeight($(e).outerHeight()?$(e).outerHeight():"100%").css($(e).css(["top","left"])).addClass("jqui-wrapper");return $(e).wrap(t).outerWidth("100%").outerHeight("100%").css({top:"0px",left:"0px"}).parent().get(0)},removeWrapper=function(e){var t=$(e);t.hasClass("jqui-wrapper")&&(t.hasClass("ui-draggable")||t.hasClass("ui-droppable")||t.hasClass("ui-selectable")||t.hasClass("ui-sortable")||t.hasClass("ui-resizable")||(t.children(".shiny-bound-output").outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).css(t.css(["top","left"])).insertAfter(t),t.remove()))},getWrapper=function(e){return $(e).parent().hasClass("jqui-wrapper")&&(e=$(e).parent().get(0)),e},addIndex=function(e){var t=$(e),i=shinyjqui.getId(e);if(t.hasClass("ui-sortable")&&i&&(t.find(".ui-sortable-handle").attr("jqui_sortable_idx",function(e,t){return i+"__"+(e+1)}),t.trigger("sortcreate")),t.hasClass("ui-draggable")&&t.draggable("option","connectToSortable")&&!t.is("[jqui_sortable_idx]")){var n=$(".ui-draggable").filter("[jqui_sortable_idx]").length;t.attr("jqui_sortable_idx",n+1)}t.hasClass("ui-selectable")&&i&&(t.find(".ui-selectee").attr("jqui_selectable_idx",function(e,t){return i+"__"+(e+1)}),t.trigger("selectablecreate"))},removeIndex=function(e){var t=$(e);t.hasClass("ui-selectable")||t.find(".ui-selectee").removeAttr("jqui_seletable_idx"),t.hasClass("ui-sortable")||t.find(".ui-sortable-handle").removeAttr("jqui_sortable_idx"),t.hasClass("ui-draggable")||t.removeAttr("jqui_sortable_idx")},interaction_settings={draggable:{getState:function(e){return $(e).offset()},setState:function(e,t){var i=$(e),n=new $.Event("mousedown",{pageX:i.offset().left,pageY:i.offset().top}),a=new $.Event("mouseup",{pageX:t.left,pageY:t.top});i.data("uiDraggable")._mouseStart(n),i.data("uiDraggable")._mouseDrag(a),i.data("uiDraggable")._mouseStop(a)},shiny:{_shinyjquiBookmarkState__draggable:{"dragcreate dragstop":function(e,t){return interaction_settings.draggable.getState(e.target)}},position:{"dragcreate drag dragstop":function(e,t){return $(e.target).position()}},is_dragging:{"dragcreate dragstop":function(e,t){return!1},dragstart:function(e,t){return!0}}}},droppable:{getState:function(e){},setState:function(e,t){},shiny:{over:{dropcreate:function(e,t){return[]},dropover:function(e,t){return shinyjqui.getId(t.draggable.get(0))}},drop:{dropcreate:function(e,t){return[]},drop:function(e,t){return shinyjqui.getId(t.draggable.get(0))}},out:{dropcreate:function(e,t){return[]},dropout:function(e,t){return shinyjqui.getId(t.draggable.get(0))}},dragging:{dropcreate:function(e,t){return[]},dropactivate:function(e,t){return shinyjqui.getId(t.draggable.get(0))},dropdeactivate:function(e,t){return[]}},dropped:{dropcreate:function(e,t){return $(e.target).data("shinyjqui_droppedIds",[]),[]},drop:function(e,t){var i=$(e.target).data("shinyjqui_droppedIds"),n=shinyjqui.getId(t.draggable.get(0));return-1==$.inArray(n,i)&&i.push(n),$(e.target).data("shinyjqui_droppedIds",i),i},dropout:function(e,t){var i=$(e.target).data("shinyjqui_droppedIds"),n=shinyjqui.getId(t.draggable.get(0));return i.splice($.inArray(n,i),1),$(e.target).data("shinyjqui_droppedIds",i),i}}}},resizable:{getState:function(e){return{width:$(e).width(),height:$(e).height()}},setState:function(e,t){var i=$(e),n=new $.Event("mousedown",{pageX:0,pageY:0}),a=new $.Event("mouseup",{pageX:t.width-i.width(),pageY:t.height-i.height()});i.data("uiResizable").axis="se",i.data("uiResizable")._mouseStart(n),i.data("uiResizable")._mouseDrag(a),i.data("uiResizable")._mouseStop(a)},shiny:{_shinyjquiBookmarkState__resizable:{"resizecreate resizestop":function(e,t){return interaction_settings.resizable.getState(e.target)}},size:{"resize resizestop":function(e,t){return{width:t.size.width,height:t.size.height}},resizecreate:function(e,t){return{width:$(e.target).width(),height:$(e.target).height()}}},is_resizing:{"resizecreate resizestop":function(e,t){return!1},resizestart:function(e,t){return!0}}}},selectable:{getState:function(e){var t=$(e).find(".ui-selected"),i=t.map(function(e,t){return $(t).attr("jqui_selectable_idx")}).get();return{selected:t,index:i}},setState:function(e,t){var i,n=$(e),a=n.selectable("option","classes.ui-selected");a=a?"ui-selected "+a:"ui-selected",t.selected instanceof jQuery?i=t.selected:(Array.isArray(t.index)||(t.index=Array(t.index)),i=$(t.index).map(function(e,t){return $("[jqui_selectable_idx="+t+"]").get(0)})),n.find(".ui-selected").not(i).removeClass(a).addClass("ui-unselecting"),i.not(".ui-selected").addClass("ui-selecting"),n.data("uiSelectable")._mouseStop(null)},shiny:{_shinyjquiBookmarkState__selectable:{"selectablecreate selectablestop":function(e,t){var i=interaction_settings.selectable.getState(e.target);return i.selected="",i}},"selected:shinyjqui.df":{"selectablecreate selectablestop":function(e,t){var i=$(e.target).find(".ui-selected"),n=i.map(function(e,t){return t.innerText?t.innerText:""}).get();return{id:i.map(function(e,t){return shinyjqui.getId(t)}).get(),text:n}}},is_selecting:{"selectablecreate selectablestop":function(e,t){return!1},selectablestart:function(e,t){return!0}}}},sortable:{getState:function(e){var t=$(e).find(".ui-sortable-handle,.ui-draggable").clone(),i=t.map(function(e,t){return $(t).attr("jqui_sortable_idx")}).get();return{items:t,index:i}},setState:function(e,t){var i=$(e),n=i.find(".ui-sortable-handle,.ui-draggable"),a=n.length?n.parent():i;if(t.items instanceof jQuery)n.remove(),a.append(t.items);else{Array.isArray(t.index)||(t.index=Array(t.index));var r,s=n.clone(),o=$("body").data("shinyjquiTemp");o?$("body").data("shinyjquiTemp",o.add(s)):$("body").data("shinyjquiTemp",s),n.remove(),$.each(t.index,function(e,t){var i=$("body").data("shinyjquiTemp").filter("[jqui_sortable_idx="+t+"]").first();return 1==i.length?(a.append(i),!0):0==(i=$("[jqui_sortable_idx="+t+"]").first()).length?(console.warn("Can't find item [jqui_sortable_idx="+t+"] durining bookmarking restoration!"),!0):void(i.hasClass("ui-draggable")?i.clone().appendTo(a):(r=i.closest(".ui-sortable"),i.appendTo(a),r.trigger("sortupdate")))})}i.trigger("sortupdate")},shiny:{_shinyjquiBookmarkState__sortable:{"sortcreate sortupdate":function(e,t){var i=interaction_settings.sortable.getState(e.target);return i.items="",i}},"order:shinyjqui.df":{"sortcreate sortupdate":function(e,t){var i=$(e.target).sortable("option","items"),n=$(e.target).find(i),a=n.map(function(e,t){return t.innerText?t.innerText:""}).get();return{id:n.map(function(e,t){return shinyjqui.getId(t)}).get(),text:a}}}}}},interaction={enable:function(e,t,i){handleShinyInput(e,i,interaction_settings[t].shiny),$(e)[t](i),$(e)[t]("enable"),addJquiData(e),addIndex(e)},disable:function(e,t,i){handleShinyInput(e,i,interaction_settings[t].shiny),$(e)[t](i),$(e)[t]("disable")},destroy:function(e,t,i){var n=$(e);n.hasClass("ui-"+t)?(n[t]("destroy"),removeJquiData(e),removeWrapper(e),removeIndex(e),n.removeClass("shinyjqui")):console.warn("Interaction not initiated. Operation abort.")},save:function(e,t,i){var n=$(e);handleShinyInput(e,i,interaction_settings[t].shiny),n[t](i),n.data("shinyjqui")[t].save={option:n[t]("option"),state:interaction_settings[t].getState(e)}},load:function(e,t,i){var n=$(e);n.hasClass("ui-"+t)||(console.warn("Interaction not initiated. Will run initiation first."),n[t]());var a=i||n.data("shinyjqui")[t].save;a?(a.option&&n[t]("option",a.option),a.state&&interaction_settings[t].setState(e,a.state)):console.warn("Nothing can be load. Operation abort.")}};return{getId:function(e){var t=$(e).attr("id");return!t&&$(e).hasClass("tabbable")&&(t=$(e).find(".shiny-bound-input").attr("id")),t||(t=$(e).closest(".shiny-input-container").find(".shiny-bound-input").attr("id")),t||(t=$(e).closest(".jqui-wrapper").find(".shiny-bound-output").attr("id")),t||(t=$(e).closest(".shiny-bound-output").attr("id")),t||""},msgCallback:function(e){if(e=handleServerMsg(e)){var t=e.elements,i=e.type,n=e.operation,a=e.func,r=e.options;"interaction"===i?t.each(function(e,t){interaction[n](t,a,r)}):"effect"===i?t[a](effect=r.effect,options=r.options,duration=r.duration,complete=r.complete):"class"===i?"add"===a||"remove"===a?t[a+"Class"](r.className,r):"switch"===a&&t.switchClass(r.removeClassName,r.addClassName,r):"other"===i&&"position"===a&&t.position(r)}},init:function(){shinyMode&&Shiny.addCustomMessageHandler("shinyjqui",shinyjqui.msgCallback)}}}(),shinyjqui.init();
